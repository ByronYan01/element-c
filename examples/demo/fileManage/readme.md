- 可后退、回退、撤回的导航
- 拖动上传文件、文件夹
  - 文件大小、总数量`是否包含文件夹`限制
  - 文件、文件夹类型是否支持限制
  - 需要应对几种场景`读取文件、文件夹组成的数据结构`
    - 直接把所有文件以及所在路径展示出来，无需模拟层级
    - 需要有层级结构，文件夹存在所有子文件大小总和
- 并发队列

  - 支持指定并发数
  - 上传、失败、成功钩子
  - 指定删除
  - 分片

- 超过指定数量自动舍弃
- 前后数据合并再判断数量是否超过
- 各种需求，决定不内置最大数量，通过暴露钩子由具体业务方决定

- 开始读取前钩子
- 读取过程钩子
- 读取结束钩子

上传这个功能既耦合某些 HTML 标签，又和后端接口协议密切相关，算是比较脏的活，还没有看到一统江湖的优秀通用性轮子。虽然很希望能拿现成轮子偷懒，不过现阶段还是老实读了然后谢谢总结比较好 window.URL.createObjectURL()做预览

web 资源上传之读取，拖拽黏贴（文件、文件夹）等等通通拿捏

目前市面大多数工具是读取、上传混合一起的，没有专门读取工具；由于最近项目多处需要资源读取上传，具体做法是把资源读取、上传封装成两个工具，读取后的展示以及用户交互交给具体业务实现人，最后通过上传工具上传；

资源读取负责把常见的情况内置，尽量不耦合 HTML 标签，提供易于处理的数据格式，追求灵活大于便捷

资源上传负责控制并发、进度、取消、重试分片、对接后端接口协议等等

现把资源读取封装成 npm 库，并整理了相关的业务场景，希望能对大家有帮助，高效完成任务，愉快摸鱼（本人能力有限，望大佬轻喷，欢迎提建议、提交 pr 完善代码更好哈哈哈）

需求

由于浏览器安全策略，网页操作本地文件需要通过用户触发，常见的三种触发方式

- input type="file" 选择
- 拖拽的方式
- 复制粘贴

资源读取的目标

- 具体文件
- 文件夹
- 文件、文件夹混合

展示数据形式

- 平铺
  - 预览、展示部分信息
- 树形
  - 文件夹需要展示其下所有文件的总大小

d-resouce 简单介绍，详情见 github

- 传入目标元素，内部会使元素支持拖拽、黏贴方式，支持文件、文件夹、以及混合读取

- 资源读取前、中、后会触发相应函数，方便业务灵活处理

  - 读取前`beforeReadFuc`
  - 读取中
    - 过滤，不会中断资源读取`beforeReadFuc`
      - 回调顺序，如下图
    - 检测，会中断资源读取`validFuc`
      - 回调顺序，只有文件会触发，如下图
  - 读取后`readDataFuc`
    - 数据会根据传入 mode 进行数据组件，支持数组、树形两种

- UI 效果处理

  - 拖拽文件移入、离开目标元素会触发相应回调函数`dragoverFuc、dragleaveFuc`

- 文件 size 属性转为可读性良好的单位展示`filterSize`
- 调用系统资源框供用户选择`selectResource`
- 原生文件合集按照 mode 类型组装
  - 文件、多个文件`selectFileChange`
  - 文件夹`selectFolderChange`

基于 d-resouce 实现的简单 demo
